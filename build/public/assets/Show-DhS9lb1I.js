import{u as M,j as S,r as x,h as k,F as q,k as j,m as Q,a as p,c as N,d as i,e as D,b as e,f as l,t as v,p as T,i as z,o as O,q as V}from"./app-0IfQhdzz.js";import{l as B}from"./lodash-B7kL0Lw1.js";import F from"./Dialog-BQ-8YqpJ.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={__name:"Show",props:{craftList:{type:Object,required:!0},inventory:{type:Array,required:!0}},setup(P,{expose:r}){r();const c=M(),t=S(),m=P,y=x(!1),f=x(new Map),d=x([]);k(()=>m.craftList,()=>{g()},{deep:!0});const b=()=>{y.value=!1,T(()=>{y.value=!0})},u=()=>{c.require({message:`Voulez vous supprimer votre liste de craft "${m.craftList.name}" ?`,header:"Suppression de liste",icon:"pi pi-info-circle",rejectLabel:"Annuler",rejectProps:{label:"Annuler",severity:"secondary",outlined:!0},acceptProps:{label:"Supprimer",severity:"danger"},accept:()=>{q.delete(`/crafting-list/${m.craftList.id}`)},reject:()=>{console.log("reject")}})},g=()=>{const s=new Map;m.craftList.items.forEach(a=>{a.resources.forEach(o=>{var E;const A=((E=m.inventory.find(C=>C.resourceId===o.id))==null?void 0:E.quantity)||0;f.value.set(o.id,A);const I=o.quantityRequired*a.quantity;if(s.has(o.id)){const C=s.get(o.id);C.totalRequired+=I}else s.set(o.id,{id:o.id,name:o.name,type:o.type,totalRequired:I,isCraftable:o.isCraftable})})}),d.value=Array.from(s.values())},_=(s,a)=>{f.value.set(s.id,a)},h=B.debounce(async(s,a)=>{try{console.log(`Mise à jour de l'inventaire pour ${s.name} vers ${a}`),await q.post("/inventory",{resource:s,quantity:a,redirectRoute:"/crafting-list/:id",redirectRouteOptions:{params:{id:m.craftList.id},preserveScroll:!0}}),t.add({severity:"success",summary:"Inventaire mis à jour",detail:`Quantité mise à jour pour ${s.name}`,life:3e3})}catch(o){console.log("Erreur lors de la mise à jour de l'inventaire",o),f.value.set(s.id,s.inInventory),t.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la mise à jour de l'inventaire",life:3e3})}},500),L=(s,a)=>{_(s,a),h(s,a)},n=s=>{if(!s)return 0;const a=f.value.get(s.id)||0;return Math.round(Math.min(100,a/s.totalRequired*100))},w=j(()=>{if(!d.value.length)return 0;const s=d.value.reduce((a,o)=>a+n(o),0);return Math.round(s/d.value.length)}),U=j(()=>`${d.value.filter(a=>(f.value.get(a.id)||0)>=a.totalRequired).length}/${d.value.length}`);Q(()=>{g()});const R={confirm:c,toast:t,props:m,showDialog:y,inventoryQuantities:f,resourcesList:d,openEditDialog:b,confirmDeleteCraftList:u,initializeData:g,updateLocalInventory:_,saveInventory:h,handleInventoryUpdate:L,calculateProgress:n,progressPercentage:w,formatProgress:U,ref:x,computed:j,onMounted:Q,nextTick:T,watch:k,get router(){return q},get Link(){return z},get useToast(){return S},get debounce(){return B.debounce},get useConfirm(){return M},CraftingListDialog:F};return Object.defineProperty(R,"__isScriptSetup",{enumerable:!1,value:!0}),R}},J={class:"p-4 bg-gray-100 min-h-screen"},K={class:"mb-6"},W={class:"flex items-center gap-2 text-gray-600 mb-2"},X={class:"flex justify-between items-center"},Y={class:"text-3xl font-semibold"},Z={class:"flex gap-2"},$={class:"grid gap-4 mb-6"},ee={class:"flex justify-between items-center w-full"},te={class:"flex justify-between items-center w-full"},se={class:"flex items-center gap-2"},ne={class:"text-sm"},ie={class:"relative"},ae={class:"absolute inset-0 flex items-center justify-center text-xs font-medium"},re={class:"flex flex-col"},oe={class:"text-xs text-gray-500"},le={class:"flex items-center gap-2"},ce={class:"relative"},de={class:"absolute inset-0 flex items-center justify-center text-xs font-medium"};function ue(P,r,c,t,m,y){const f=p("Toast"),d=p("ConfirmDialog"),b=p("Button"),u=p("Column"),g=p("DataTable"),_=p("Panel"),h=p("ProgressBar"),L=p("InputNumber");return O(),N("div",J,[i(f),i(d),D(" En-tête avec navigation "),e("div",K,[e("div",W,[i(t.Link,{href:"/crafting-list",class:"hover:text-primary-500"},{default:l(()=>r[3]||(r[3]=[e("i",{class:"pi pi-home"},null,-1),e("span",{class:"ml-2"},"Accueil",-1)])),_:1}),r[4]||(r[4]=e("i",{class:"pi pi-angle-right text-sm"},null,-1)),e("span",null,v(c.craftList.name),1)]),e("div",X,[e("h1",Y,v(c.craftList.name),1),e("div",Z,[i(b,{icon:"pi pi-pencil",label:"Modifier",onClick:t.openEditDialog}),i(b,{icon:"pi pi-trash",label:"Supprimer",class:"p-button-danger",onClick:r[0]||(r[0]=n=>t.confirmDeleteCraftList()),text:""})])])]),D(" Liste des items "),e("div",$,[i(_,{toggleable:!0,expanded:!0},{header:l(()=>[e("div",ee,[e("span",null,"Items à crafter ("+v(c.craftList.items.length)+")",1)])]),default:l(()=>[i(g,{value:c.craftList.items,class:"p-datatable-sm",stripedRows:""},{default:l(()=>[i(u,{field:"name",header:"Item"}),i(u,{field:"type",header:"Type"}),i(u,{header:"Quantité",field:"quantity"})]),_:1},8,["value"])]),_:1})]),D(" Tableau des ressources "),i(_,{toggleable:!0,expanded:!0},{header:l(()=>[e("div",te,[r[5]||(r[5]=e("span",null,"Ressources nécessaires",-1)),e("div",se,[e("span",ne," Progression: "+v(t.formatProgress),1),e("div",ie,[i(h,{value:t.progressPercentage,class:"w-36",showValue:!1},null,8,["value"]),e("div",ae,v(Math.round(t.progressPercentage))+"% ",1)])])])]),default:l(()=>[i(g,{value:t.resourcesList,class:"p-datatable-sm",stripedRows:"",sortField:"name",sortOrder:1},{default:l(()=>[i(u,{field:"name",header:"Ressource",sortable:""},{body:l(({data:n})=>[e("div",re,[e("span",null,v(n.name),1),e("span",oe,v(n.type),1)])]),_:1}),i(u,{field:"totalRequired",header:"Quantité nécessaire",sortable:""}),i(u,{field:"inInventory",header:"En inventaire",sortable:""},{body:l(({data:n})=>[e("div",le,[i(L,{"model-value":t.inventoryQuantities.get(n.id)||0,min:0,showButtons:"",class:V(["w-32",{"p-invalid":(t.inventoryQuantities.get(n.id)||0)<n.totalRequired}]),"onUpdate:modelValue":w=>t.handleInventoryUpdate(n,w)},null,8,["model-value","onUpdate:modelValue","class"]),e("i",{class:V({"pi pi-check text-green-500":(t.inventoryQuantities.get(n.id)||0)>=n.totalRequired,"pi pi-times text-red-500":(t.inventoryQuantities.get(n.id)||0)<n.totalRequired})},null,2)])]),_:1}),i(u,{header:"Progression",class:"w-36"},{body:l(({data:n})=>[e("div",ce,[i(h,{value:t.calculateProgress(n),showValue:!1},null,8,["value"]),e("div",de,v(Math.round(t.calculateProgress(n)))+"% ",1)])]),_:1})]),_:1},8,["value"])]),_:1}),i(t.CraftingListDialog,{modelValue:t.showDialog,"onUpdate:modelValue":r[1]||(r[1]=n=>t.showDialog=n),"craft-list":c.craftList,"redirect-route":"/crafting-list/:id","redirect-route-options":{params:{id:c.craftList.id},preserveScroll:!0},onClose:r[2]||(r[2]=n=>t.showDialog=!1)},null,8,["modelValue","craft-list","redirect-route-options"])])}const ge=G(H,[["render",ue],["__scopeId","data-v-0b42c416"],["__file","/Users/florian/Desktop/recipz/inertia/pages/CraftingList/Show.vue"]]);export{ge as default};
