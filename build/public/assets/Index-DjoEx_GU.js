import{u as F,j as S,r as h,k as U,a as u,c as y,d as n,e as _,b as i,f as l,i as M,F as L,o as f,g,l as R,t as p,v as P,x as z}from"./app-0IfQhdzz.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={__name:"Index",props:{craftLists:{type:Array,required:!0},recentResources:{type:Array,required:!0}},setup(k,{expose:e}){e();const v=F(),s=k;console.log(s.craftLists);const m=S(),b=h(!1),r=h({id:null,name:"",items:[]}),c=h(null),d=h([]),C=U(()=>r.value.name.trim()!==""&&r.value.items.length>0),A={confirm:v,props:s,toast:m,showCreateListDialog:b,listForm:r,selectedItem:c,suggestions:d,canCreate:C,searchItems:async o=>{if(o.query.trim().length<2){d.value=[];return}try{const I=await(await fetch(`/items/search?q=${o.query}`)).json();d.value=I}catch{m.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la recherche des items",life:3e3})}},addItem:o=>{const a=o.value;r.value.items.some(D=>D.id===a.id)?m.add({severity:"info",summary:"Information",detail:"Cet item est déjà dans la liste",life:2e3}):r.value.items.push({id:a.id,name:a.name,type:a.type,quantity:1}),c.value=null},removeItem:o=>{r.value.items=r.value.items.filter(a=>a.id!==o)},createNewList:()=>{L.post("/crafting-list",{name:r.value.name,items:r.value.items.map(o=>({id:o.id,quantity:o.quantity}))},{onSuccess:()=>{m.add({severity:"success",summary:"Liste créée",detail:"Votre nouvelle liste a été créée avec succès",life:3e3}),b.value=!1,r.value={name:"",items:[]}},onError:o=>{m.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue lors de la création",life:3e3})}})},updateList:()=>{L.put(`/crafting-list/${r.value.id}`,{name:r.value.name,items:r.value.items.map(o=>({id:o.id,quantity:o.quantity}))},{onSuccess:()=>{m.add({severity:"success",summary:"Liste modifiée",detail:"Votre liste a été modifiée avec succès",life:3e3}),b.value=!1,r.value={name:"",items:[]}},onError:o=>{m.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue lors de la modification",life:3e3})}})},formatMissingResources:o=>{if(!o.items||!o.items.length)return"0/0";const a=o.items.reduce((D,T)=>D+T.resources.reduce((E,B)=>E+B.quantityRequired,0),0);return`${Object.values(o.available_resources||{}).length}/${a}`},openUpdateList:o=>{r.value={id:o.id,name:o.name,items:o.items.map(a=>({id:a.id,name:a.name,type:a.type,quantity:a.quantity}))},b.value=!0},confirmDeleteCraftList:o=>{console.log(o),v.require({message:`Voulez vous supprimer votre liste de crafts "${o.name}" ?`,header:"Suppression de ressource",icon:"pi pi-info-circle",rejectLabel:"Annuler",rejectProps:{label:"Annuler",severity:"secondary",outlined:!0},acceptProps:{label:"Supprimer",severity:"danger"},accept:()=>{L.delete(`/crafting-list/${o.id}`)},reject:()=>{console.log("reject")}})},ref:h,computed:U,get Link(){return M},get useToast(){return S},get router(){return L},get useConfirm(){return F}};return Object.defineProperty(A,"__isScriptSetup",{enumerable:!1,value:!0}),A}},Q={class:"p-4 bg-gray-100 w-[100vw] h-[100vh]"},H={class:"flex justify-between items-center mb-6"},J={class:"grid"},K={class:"col-12 lg:col-8 mb-10"},W={class:"flex justify-between items-center"},X={key:0},Y={class:"flex justify-end"},Z={class:"col-12 lg:col-4"},$={class:"flex justify-between items-center"},ee={key:0},te={class:"flex flex-col gap-4"},se={class:"field"},oe={class:"field"},ie={class:"flex gap-2"},ne={class:"flex items-center gap-2"},re={class:"text-sm text-gray-500"},le={key:0,class:"border rounded-lg px-3"},ae={class:"flex flex-col"},de={class:"font-medium"},ce={class:"text-sm text-gray-500"},ue={class:"flex items-center gap-2"};function me(k,e,v,s,m,b){const r=u("ConfirmDialog"),c=u("Button"),d=u("Column"),C=u("DataTable"),w=u("Card"),q=u("InputText"),V=u("AutoComplete"),j=u("InputNumber"),N=u("Dialog");return f(),y("div",Q,[n(r),_(" En-tête "),i("div",H,[e[6]||(e[6]=i("h1",{class:"text-3xl font-semibold"},"Tableau de bord",-1)),n(c,{icon:"pi pi-plus",label:"Nouvelle liste",severity:"success",onClick:e[0]||(e[0]=t=>s.showCreateListDialog=!0)})]),_(" Section des listes de craft "),i("div",J,[i("div",K,[n(w,null,{title:l(()=>[i("div",W,[e[8]||(e[8]=i("span",null,"Mes listes de craft",-1)),n(s.Link,{href:"/craft-lists",class:"text-sm text-primary-500 hover:underline"},{default:l(()=>e[7]||(e[7]=[g(" Voir tout ")])),_:1})])]),content:l(()=>[v.craftLists.length?(f(),R(C,{key:1,value:v.craftLists,rows:5,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:l(()=>[n(d,{field:"name",header:"Nom"},{body:l(({data:t})=>[n(s.Link,{href:`/craft-lists/${t.id}`,class:"text-primary-600 hover:underline"},{default:l(()=>[g(p(t.name),1)]),_:2},1032,["href"])]),_:1}),n(d,{header:"Nombre d'items"},{body:l(({data:t})=>[g(p(t.items.length),1)]),_:1}),n(d,{header:"Ressources"},{body:l(({data:t})=>[g(p(s.formatMissingResources(t)),1)]),_:1}),n(d,{field:"updated_at",header:"Dernière modification"},{body:l(({data:t})=>[g(p(new Date(t.updatedAt).toLocaleDateString()),1)]),_:1}),n(d,null,{body:l(({data:t})=>[i("div",Y,[n(c,{icon:"pi pi-pencil",class:"mr-2 p-button-outlined p-button-primary",onClick:x=>s.openUpdateList(t)},null,8,["onClick"]),n(c,{icon:"pi pi-trash",class:"p-button-danger",onClick:x=>s.confirmDeleteCraftList(t)},null,8,["onClick"])])]),_:1})]),_:1},8,["value"])):(f(),y("div",X,e[9]||(e[9]=[i("p",{class:"text-gray-500 text-center"},"Aucune liste de craft pour le moment",-1)])))]),_:1})]),_(" Section inventaire "),i("div",Z,[n(w,null,{title:l(()=>[i("div",$,[e[11]||(e[11]=i("span",null,"Aperçu de l'inventaire",-1)),n(s.Link,{href:"/inventory",class:"text-sm text-primary-500 hover:underline"},{default:l(()=>e[10]||(e[10]=[g(" Gérer ")])),_:1})])]),content:l(()=>[v.recentResources.length?(f(),R(C,{key:1,value:v.recentResources,rows:5,class:"p-datatable-sm"},{default:l(()=>[n(d,{field:"name",header:"Ressource"}),n(d,{field:"quantity",header:"Quantité"})]),_:1},8,["value"])):(f(),y("div",ee,e[12]||(e[12]=[i("p",{class:"text-gray-500 text-center"},"Aucune ressource récente",-1)])))]),_:1})])]),_(" Dialog création de liste "),n(N,{visible:s.showCreateListDialog,"onUpdate:visible":e[5]||(e[5]=t=>s.showCreateListDialog=t),modal:"",header:s.listForm.id?"Modifier liste de craft":"Nouvelle liste de craft",style:{width:"500px"}},{footer:l(()=>[n(c,{label:"Annuler",icon:"pi pi-times",text:"",onClick:e[3]||(e[3]=t=>s.showCreateListDialog=!1)}),n(c,{label:s.listForm.id?"Modifier":"Créer",icon:"pi pi-check",onClick:e[4]||(e[4]=t=>s.listForm.id?s.updateList():s.createNewList()),loading:k.$inertia.processing,disabled:!s.canCreate},null,8,["label","loading","disabled"])]),default:l(()=>[i("div",te,[i("div",se,[e[13]||(e[13]=i("label",{for:"name",class:"font-bold"},"Nom",-1)),n(q,{id:"name",modelValue:s.listForm.name,"onUpdate:modelValue":e[1]||(e[1]=t=>s.listForm.name=t),class:"w-full",autofocus:""},null,8,["modelValue"])]),i("div",oe,[e[14]||(e[14]=i("label",{class:"font-bold"},"Ajouter un item",-1)),i("div",ie,[n(V,{modelValue:s.selectedItem,"onUpdate:modelValue":e[2]||(e[2]=t=>s.selectedItem=t),suggestions:s.suggestions,delay:300,class:"w-full",optionLabel:"name",placeholder:"Rechercher un item...",onComplete:s.searchItems,onItemSelect:s.addItem,pt:{item:{class:"custom-item"}}},{item:l(({item:t})=>[i("div",ne,[i("span",null,p(t.name),1),i("span",re,"("+p(t.type)+")",1)])]),_:1},8,["modelValue","suggestions"])])]),_(" Liste des items ajoutés "),s.listForm.items.length>0?(f(),y("div",le,[(f(!0),y(P,null,z(s.listForm.items,t=>(f(),y("div",{key:t.id,class:"flex items-center justify-between py-2 border-b last:border-b-0"},[i("div",ae,[i("span",de,p(t.name),1),i("span",ce,p(t.type),1)]),i("div",ue,[n(j,{modelValue:t.quantity,"onUpdate:modelValue":x=>t.quantity=x,min:1,showButtons:"",step:1,class:"w-20"},null,8,["modelValue","onUpdate:modelValue"]),n(c,{icon:"pi pi-trash",severity:"danger",text:"",onClick:x=>s.removeItem(t.id)},null,8,["onClick"])])]))),128))])):_("v-if",!0)])]),_:1},8,["visible","header"])])}const ye=O(G,[["render",me],["__scopeId","data-v-b81c301c"],["__file","/Users/florian/Desktop/recipz/inertia/pages/Tes/Index.vue"]]);export{ye as default};
