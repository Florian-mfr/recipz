import{j as q,r as v,k as V,h as w,a as p,l as D,f as I,F,o as _,d,b as i,t as g,e as j,c as C,v as B,x as N}from"./app-0IfQhdzz.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={__name:"Dialog",props:{modelValue:{type:Boolean,required:!0},craftList:{type:Object,default:null},redirectRoute:{type:String,default:null},redirectRouteOptions:{type:Object,default:()=>({})}},emits:["update:modelValue","close"],setup(y,{expose:l,emit:L}){l();const e=y,f=L,n=q(),c=v(null),m=v([]),s=v({id:null,name:"",items:[]}),r=V({get:()=>e.modelValue,set:o=>f("update:modelValue",o)});w(()=>e.modelValue,o=>{o&&e.craftList?s.value={id:e.craftList.id,name:e.craftList.name,items:e.craftList.items.map(a=>({id:a.id,name:a.name,type:a.type,quantity:a.quantity}))}:(s.value={id:null,name:"",items:[]},c.value=null)},{immediate:!0,deep:!0});const b=V(()=>s.value.name.trim()!==""&&s.value.items.length>0),t=()=>{r.value=!1,f("close")},k={props:e,emit:f,toast:n,selectedItem:c,suggestions:m,listForm:s,isVisible:r,canCreate:b,closeDialog:t,searchItems:async o=>{if(o.query.trim().length<2){m.value=[];return}try{const x=await(await fetch(`/items/search?q=${o.query}`)).json();m.value=x}catch{n.add({severity:"error",summary:"Erreur",detail:"Erreur lors de la recherche des items",life:3e3})}},addItem:o=>{const a=o.value;s.value.items.some(u=>u.id===a.id)?n.add({severity:"info",summary:"Information",detail:"Cet item est déjà dans la liste",life:2e3}):s.value.items.push({id:a.id,name:a.name,type:a.type,quantity:1}),c.value=null},removeItem:o=>{s.value.items=s.value.items.filter(a=>a.id!==o)},saveCraftList:()=>{const o=s.value.id!==null,a=o?`/crafting-list/${s.value.id}`:"/crafting-list";F[o?"put":"post"](a,{name:s.value.name,items:s.value.items.map(u=>({id:u.id,quantity:u.quantity})),redirectRoute:e.redirectRoute,redirectRouteOptions:e.redirectRouteOptions},{onSuccess:()=>{n.add({severity:"success",summary:o?"Liste modifiée":"Liste créée",detail:o?"Votre liste a été modifiée avec succès":"Votre nouvelle liste a été créée avec succès",life:3e3}),t()},onError:u=>{n.add({severity:"error",summary:"Erreur",detail:"Une erreur est survenue",life:3e3})}})},ref:v,computed:V,watch:w,get router(){return F},get useToast(){return q}};return Object.defineProperty(k,"__isScriptSetup",{enumerable:!1,value:!0}),k}},E={class:"flex flex-col gap-4"},O={class:"field"},S={class:"field"},A={class:"flex gap-2"},T={class:"flex items-center gap-2"},M={class:"text-sm text-gray-500"},z={key:0,class:"border rounded-lg px-3"},P={class:"flex flex-col"},G={class:"font-medium"},H={class:"text-sm text-gray-500"},J={class:"flex items-center gap-2"};function K(y,l,L,e,f,n){const c=p("InputText"),m=p("AutoComplete"),s=p("InputNumber"),r=p("Button"),b=p("Dialog",!0);return _(),D(b,{visible:e.isVisible,"onUpdate:visible":[l[2]||(l[2]=t=>e.isVisible=t),l[3]||(l[3]=t=>e.emit("update:modelValue",t))],modal:"",header:e.listForm.id?"Modifier liste de craft":"Nouvelle liste de craft",style:{width:"500px"}},{footer:I(()=>[d(r,{label:"Annuler",icon:"pi pi-times",text:"",onClick:e.closeDialog}),d(r,{label:e.listForm.id?"Modifier":"Créer",icon:"pi pi-check",onClick:e.saveCraftList,loading:y.$inertia.processing,disabled:!e.canCreate},null,8,["label","loading","disabled"])]),default:I(()=>[i("div",E,[i("div",O,[l[4]||(l[4]=i("label",{for:"name",class:"font-bold"},"Nom",-1)),d(c,{id:"name",modelValue:e.listForm.name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.listForm.name=t),class:"w-full",autofocus:""},null,8,["modelValue"])]),i("div",S,[l[5]||(l[5]=i("label",{class:"font-bold"},"Ajouter un item",-1)),i("div",A,[d(m,{modelValue:e.selectedItem,"onUpdate:modelValue":l[1]||(l[1]=t=>e.selectedItem=t),suggestions:e.suggestions,delay:300,class:"w-full",optionLabel:"name",placeholder:"Rechercher un item...",onComplete:e.searchItems,onItemSelect:e.addItem,pt:{item:{class:"custom-item"}}},{item:I(({item:t})=>[i("div",T,[i("span",null,g(t.name),1),i("span",M,"("+g(t.type)+")",1)])]),_:1},8,["modelValue","suggestions"])])]),j(" Liste des items ajoutés "),e.listForm.items.length>0?(_(),C("div",z,[(_(!0),C(B,null,N(e.listForm.items,t=>(_(),C("div",{key:t.id,class:"flex items-center justify-between py-2 border-b last:border-b-0"},[i("div",P,[i("span",G,g(t.name),1),i("span",H,g(t.type),1)]),i("div",J,[d(s,{modelValue:t.quantity,"onUpdate:modelValue":h=>t.quantity=h,min:1,showButtons:"",step:1,class:"w-20",fluid:""},null,8,["modelValue","onUpdate:modelValue"]),d(r,{icon:"pi pi-trash",severity:"danger",text:"",onClick:h=>e.removeItem(t.id)},null,8,["onClick"])])]))),128))])):j("v-if",!0)])]),_:1},8,["visible","header"])}const $=R(U,[["render",K],["__scopeId","data-v-f38470c7"],["__file","/Users/florian/Desktop/recipz/inertia/pages/CraftingList/Dialog.vue"]]);export{$ as default};
